<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="build" name="deploy"
	xmlns:fx="javafx:com.sun.javafx.tools.ant">
	
	<!-- 
		This script produces an MSI for a self-contained Java application
		(includes JVM). 
		http://docs.oracle.com/javafx/2/deployment/self-contained-packaging.htm
		
		In order to create a 32bit or 64bit installer, start ANT under a
		32bit resp. 64bit Java.
		
		The deploy process for a 64bit installer finishes with error 
		"Bundler "MSI Installer" (msi) failed to produce a bundle."
		The MSI is created anyway and can be installed.  
	 -->

	<property name="project.dir" value="." />
	<property name="lib.dir" value="${project.dir}/../lib" />
	<property name="dll.dir" value="${lib.dir}/${sun.arch.data.model}" />
	<property name="dist.dir" value="${project.dir}/dist/${sun.arch.data.model}" />
	<property name="application.title" value="CreateNoteAddIn" />
	<property name="javafx.main.class" value="com.wilutions.joa.AddinApplication" />
	
	<property name="application.vendor" value="WILUTIONS" />
	<property name="javafx.run.width" value="100" />
	<property name="javafx.run.height" value="100" />

	<property environment="env" />
	<property name="jdk.home" value="${java.home}/.." />
	<property name="javafx.lib.ant-javafx.jar" value="${jdk.home}/lib/ant-javafx.jar" />

	<taskdef resource="com/sun/javafx/tools/ant/antlib.xml" uri="javafx:com.sun.javafx.tools.ant"
		classpath="${javafx.lib.ant-javafx.jar};." />
			<!-- added ";." to classpath in order to load ./package/windows/CreateNoteAddin.wxs --> 
	
	<target name="build">

		<echo message="jdk=${jdk.home}" />
		<echo message="native=${dll.dir}" />
		<mkdir dir="${dist.dir}" />
		<delete dir="${dist.dir}" verbose="true" />

		<fx:application id="createNoteAddIn" name="CreateNoteAddIn"
			mainClass="${javafx.main.class}" />
		
		<fx:jar destfile="${dist.dir}/ctp4iptor.jar">

			<!-- Define what to launch -->
			<fx:application refid="createNoteAddIn" />

			<manifest>
				<attribute name="Implementation-Vendor" value="${application.vendor}" />
				<attribute name="Implementation-Title" value="${application.title}" />
				<attribute name="Implementation-Version" value="1.0" />
			</manifest>

			<!-- Define what files to include -->
			<fileset dir="./bin" />
			<fileset dir="../joa/bin" />
		</fx:jar>

		<fx:deploy verbose="true" width="${javafx.run.width}" height="${javafx.run.height}"
			nativeBundles="msi" outdir="${dist.dir}" outfile="CreateNoteAddIn">
			<fx:application name="${application.title}" mainClass="${javafx.main.class}" />
			<fx:resources>
				<fx:fileset dir="${dist.dir}" includes="*.jar" />
				<fx:fileset dir="${lib.dir}" includes="*.jar" />
				<fx:fileset dir="${dll.dir}" includes="*.dll" type="data"/>
			</fx:resources>
			
			<!-- install per user -->
			<fx:preferences install="false" />

			<fx:info title="${application.title}" vendor="${application.vendor}" />
		</fx:deploy>

	</target>

</project>